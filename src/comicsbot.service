#!/usr/bin/env bash

set -e

start() {
	cd /var/www/.htsecure/comicsbot
	git pull || true
	npm install || true
	# Rebuild binaries, for when Node.js itself updates.
	npm rebuild || true
	# Run tsc.
	npm run build
	( npm start |& logger -t comicsbot & )
	echo 'comicsbot started'
}

stop() {
	pkill --exact comicsbot || echo 'comicsbot process not found' >&2
}

restart() {
	stop
	start
}

"$1"
